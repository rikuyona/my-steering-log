<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>選択するだけ日記</title>
    <style>
      body {
        font-family: sans-serif;
        max-width: 720px;
        margin: auto;
        padding: 20px;
      }
      h2 {
        margin-top: 32px;
      }
      .section {
        padding: 16px;
        border: 1px solid #ccc;
        border-radius: 10px;
        margin-bottom: 20px;
      }
      button {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        background: #333;
        color: #fff;
        font-size: 16px;
        cursor: pointer;
      }
      .saved {
        margin-top: 12px;
        color: green;
      }
    </style>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#1a1f24" />
    <link rel="stylesheet" href="style.css" />
    <script src="app.js"></script>

    <!-- PWA でホーム画面に追加できるようにする -->
    <script>
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("service-worker.js");
      }
    </script>
  </head>
  <body>
    <h1>MBTI式 選択するだけ日記</h1>
    <p>毎日3分で終わる、選択式の日記アプリ。</p>

    <div id="form"></div>

    <script>
      const formEl = document.getElementById("form");

      const sections = [
        {
          title: "今日の気分パラメータ",
          items: [
            {
              q: "気分",
              choices: ["最高", "良い", "まあまあ", "低め", "しんどい"],
            },
            { q: "E/I", choices: ["E寄り", "I寄り", "中間"] },
            { q: "T/F", choices: ["T寄り", "F寄り", "中間"] },
            { q: "N/S", choices: ["N寄り", "S寄り"] },
            { q: "J/P", choices: ["J寄り", "P寄り", "どっちも"] },
          ],
        },
        {
          title: "影響されたもの",
          items: [
            {
              q: "今日影響されたもの",
              choices: [
                "YouTube",
                "友人",
                "仕事/学校",
                "SNS",
                "音楽/映画",
                "なし",
              ],
            },
          ],
        },
        {
          title: "心を動かした出来事",
          items: [
            {
              q: "心の動き",
              choices: ["嬉しい", "イラッ", "不安", "やる気", "無気力"],
            },
          ],
        },
        {
          title: "センターズレチェック",
          items: [
            { q: "気分屋度", choices: ["安定", "やや揺れ", "揺れ大"] },
            {
              q: "他人の一言",
              choices: ["なし", "少し", "けっこう", "引きずり"],
            },
          ],
        },
        {
          title: "性欲ログ",
          items: [
            {
              q: "今日の性欲",
              choices: ["低", "普通", "強", "振り回されそう", "コントロールOK"],
            },
          ],
        },
      ];

      function render() {
        let html = "";
        sections.forEach((sec, idx) => {
          html += `<div class='section'><h2>${sec.title}</h2>`;
          sec.items.forEach((item, iidx) => {
            html += `<p><strong>${item.q}</strong></p>`;
            item.choices.forEach((c) => {
              const name = `${idx}_${iidx}`;
              html += `<label><input type='radio' name='${name}' value='${c}'> ${c}</label><br>`;
            });
          });
          html += `</div>`;
        });

        html += `<h2>明日の自分へ</h2><textarea id='msg' rows='3' style='width:100%;'></textarea>`;
        html += `<br><br><button onclick='save()'>保存する</button><div id='saved'></div>`;

        formEl.innerHTML = html;
      }

      function save() {
        const result = {};

        sections.forEach((sec, idx) => {
          sec.items.forEach((item, iidx) => {
            const name = `${idx}_${iidx}`;
            const val = document.querySelector(`input[name='${name}']:checked`);
            result[item.q] = val ? val.value : "未選択";
          });
        });

        result["明日の自分へ"] = document.getElementById("msg").value;

        const today = new Date().toISOString().split("T")[0];
        localStorage.setItem(`diary_${today}`, JSON.stringify(result));

        document.getElementById("saved").innerHTML = "保存しました！";
      }

      render();
    </script>
  </body>
</html>

<!-- manifest.json -->
<!-- Save as manifest.json in same directory -->
<script type="application/json" id="manifest-json">
  {
    "name": "My Steering Log",
    "short_name": "SteeringLog",
    "description": "センターズレを整える、選択式セルフログアプリ",
    "start_url": "./index.html",
    "display": "standalone",
    "background_color": "#1a1f24",
    "theme_color": "#1a1f24",
    "icons": [
      {
        "src": "icon-192.png",
        "sizes": "192x192",
        "type": "image/png"
      },
      {
        "src": "icon-512.png",
        "sizes": "512x512",
        "type": "image/png"
      }
    ]
  }
</script>

<!-- service-worker.js -->
<!-- Save as service-worker.js -->
<script id="service-worker-js">
  const CACHE_NAME = "steering-log-cache-v1";
  const FILES_TO_CACHE = ["./index.html", "./manifest.json"];

  self.addEventListener("install", (event) => {
    event.waitUntil(
      caches.open(CACHE_NAME).then((cache) => cache.addAll(FILES_TO_CACHE))
    );
  });

  self.addEventListener("fetch", (event) => {
    event.respondWith(
      caches
        .match(event.request)
        .then((response) => response || fetch(event.request))
    );
  });
</script>
